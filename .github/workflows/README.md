# GitHub Actions 自動デプロイ設定

このディレクトリには、GitHubにpushした際に自動的にエックスサーバーへデプロイするための設定ファイルが含まれています。

## 設定手順

### 1. GitHubリポジトリのSecretsを設定

GitHubリポジトリのページで以下を設定してください：

1. リポジトリの「Settings」→「Secrets and variables」→「Actions」に移動
2. 「New repository secret」をクリック
3. 以下のシークレットを追加：

#### `SSH_PRIVATE_KEY`
- エックスサーバーのSSH秘密鍵
- エックスサーバーのサーバーパネルで「SSH設定」から秘密鍵をダウンロード
- 秘密鍵ファイルの全内容をコピー（`-----BEGIN RSA PRIVATE KEY-----` から `-----END RSA PRIVATE KEY-----` まで）

#### `SSH_USER`
- エックスサーバーのユーザー名: `xs752086`

### 2. SSH秘密鍵の取得方法

#### 新しいSSHキーペアを生成する場合：

1. エックスサーバーのサーバーパネルにログイン
2. 「SSH設定」を開く
3. 「SSH設定」の「ONにする」を選択
4. 「公開鍵登録・更新」タブで新しいキーペアを生成
5. 秘密鍵ファイルをダウンロード

#### 既存のSSHキーを使用する場合：

- ローカルに保存している秘密鍵ファイルを使用
- 通常は `.ssh/id_rsa` または `.ssh/xserver_rsa` など

### 3. デプロイの仕組み

- `main` ブランチに push すると自動的にデプロイが開始されます
- `welfare` ディレクトリのみが `/home/xs752086/carenavi.site/public_html/welfare/` にデプロイされます
- デプロイ後、自動的にファイルのパーミッションが設定されます

### 4. デプロイの確認

1. GitHub リポジトリの「Actions」タブで進行状況を確認
2. 緑のチェックマークが表示されれば成功
3. エラーが発生した場合は、ログを確認して対処

### 5. 除外されるファイル

以下のファイル・ディレクトリはデプロイされません：
- `.git`
- `.github`
- `README.md`
- `.gitignore`
- `daycare` ディレクトリ

## トラブルシューティング

### SSH接続エラー
- SSH_PRIVATE_KEY が正しく設定されているか確認
- 秘密鍵の形式が正しいか確認（改行が保持されているか）

### パーミッションエラー
- サーバー側のディレクトリの所有者が正しいか確認
- SSH接続で手動実行して権限を確認

### rsyncエラー
- デプロイ先のディレクトリが存在するか確認
- SSH接続が正常に機能しているか確認

## 注意事項

- **機密情報**: SSH秘密鍵は絶対にリポジトリにコミットしないでください
- **バックアップ**: 初回デプロイ前にサーバー側のファイルをバックアップしてください
- **テスト**: 本番環境へのデプロイ前にテスト環境で動作確認してください